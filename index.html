<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Detector de Razas de Perros üê∂</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
      body {
        background: #f8f9fa;
      }
      #preview {
        max-width: 300px;
        border-radius: 10px;
        margin-top: 20px;
        box-shadow: 0 0 10px rgba(0,0,0,0.2);
      }
      #resultado {
        font-size: 2rem;
        font-weight: bold;
        color: #333;
        margin-top: 20px;
      }
    </style>
  </head>
  <body class="text-center p-4">

    <div class="container">
      <h1 class="fw-bold mb-3">Detector de Razas de Perros üêæ</h1>
      <p class="lead">Sube una imagen de un perro y el modelo intentar√° adivinar su raza</p>

      <div class="mb-3">
        <input type="file" id="fileInput" accept="image/*" class="form-control w-50 mx-auto">
      </div>

      <div>
        <img id="preview" src="#" alt="Vista previa" style="display:none;">
      </div>

      <div id="resultado"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
    <script>
      let modelo;

      // 1Ô∏è‚É£ Cargar el modelo
      (async () => {
        document.getElementById("resultado").innerHTML = "Cargando modelo...";
        modelo = await tf.loadLayersModel("model.json");
        document.getElementById("resultado").innerHTML = "Modelo cargado ‚úÖ";
      })();

      // 2Ô∏è‚É£ Detectar imagen cargada
      const input = document.getElementById("fileInput");
      const preview = document.getElementById("preview");
      input.addEventListener("change", async (event) => {
        const file = event.target.files[0];
        if (!file) return;

        // Mostrar imagen
        const reader = new FileReader();
        reader.onload = (e) => {
          preview.src = e.target.result;
          preview.style.display = "block";
        };
        reader.readAsDataURL(file);

        // Esperar a que se muestre la imagen antes de predecir
        setTimeout(() => predecir(file), 300);
      });

      // 3Ô∏è‚É£ Predecir raza
      async function predecir(file) {
        if (!modelo) {
          alert("Modelo no cargado a√∫n üòÖ");
          return;
        }

        // Crear imagen temporal
        const img = document.createElement("img");
        img.src = URL.createObjectURL(file);
        await new Promise((r) => (img.onload = r));

        // Convertir a tensor
        const tensor = tf.browser
          .fromPixels(img)
          .resizeNearestNeighbor([224, 224]) // tama√±o est√°ndar del modelo
          .toFloat()
          .div(255.0)
          .expandDims();

        // Predicci√≥n
        const pred = modelo.predict(tensor);
        const data = await pred.data();
        const indice = data.indexOf(Math.max(...data));

        // Raza seg√∫n √≠ndice (seg√∫n dataset Oxford-IIIT Pet)
        const razas = [
          "Abyssinian", "american_bulldog", "american_pit_bull_terrier", "basset_hound", "beagle", "Bengal", "Birman", "Bombay", "boxer",
          "British_Shorthair", "chihuahua", "Egyptian_Mau", "english_cocker_spaniel", "english_setter", "german_shorthaired", "great_pyrenees",
          "havanese", "japanese_chin", "keeshond", "leonberger", "Maine_Coon", "miniature_pinscher", "newfoundland", "Persian", "pomeranian",
          "pug", "Ragdoll", "Russian_Blue", "saint_bernard", "samoyed", "scottish_terrier", "shiba_inu", "Siamese", "Sphynx", "staffordshire_bull_terrier",
          "wheaten_terrier", "yorkshire_terrier"
        ];

        const raza = razas[indice] || "Desconocida ü§î";
        document.getElementById("resultado").innerHTML = `Predicci√≥n: <b>${raza}</b>`;
      }
    </script>
  </body>
</html>
